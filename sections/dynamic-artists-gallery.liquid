{{ 'dynamic-artists-gallery.css' | asset_url | stylesheet_tag }}

{{ 'section-featured-artists-products.css' | asset_url | stylesheet_tag }}
{{ 'component-featured-artist-card.css' | asset_url | stylesheet_tag }}
{{ 'section-spotify-embed.css' | asset_url | stylesheet_tag }}
{{ 'swiper-bundle.min.css' | asset_url | stylesheet_tag }}

{{ 'component-product-card.css' | asset_url | stylesheet_tag }}

<script src="{{ 'swiper-bundle.min.js' | asset_url }}" defer></script>
<script src="{{ 'card-swiper.js' | asset_url }}" defer></script>

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<section class="dynamic-artists-gallery-section section-{{ section.id }}-padding color-{{ section.settings.color_scheme }} {% if settings.animations_reveal_on_scroll %} scroll-trigger animate--fade-in{% endif %}">
  <div class="dynamic-artists-gallery-wrapper">
    {% for artist in shop.metaobjects.artists.values %}
      {% assign galleryItemPos = forloop.index0 | modulo: 5 %}
      <div
        class="
          gallery-item
          {% case galleryItemPos %}
            {% when 0 or 4 %}
              gallery-item-full-width
            {% when 1 %}
              gallery-item-half-width
            {% when 2 or 3 %}
              gallery-item-half-width-half-height
          {% endcase %}
        "
        style="--grid-item-order: {{ forloop.index0 }}; --grid-item-open-order: {{ forloop.index0 | plus: 2 }}"
        data-index="{{ forloop.index0 }}"
        data-modulo="{{ forloop.index0 | modulo: 5 }}"
      >
        <img
          width="350"
          height="500"
          src="{{ artist.image | image_url: width: 350 }}"
          alt="{{ artist.title | escape }}"
          loading="lazy"
        >

        <div class="gallery-info">
          <div class="featured-artists-products">
            <div class="page-width">
              <div class="featured-artists-products__header">
                <div class="featured-artists-products__text">
                  <h2>{{ artist.title }}</h2>
                  <p>{{ artist.genre }}</p>
                  <p>{{ artist.description }}</p>
                </div>
              </div>
              <hr class="featured-artists-products__divider">
            </div>

            {% if artist.products_used %}
              <div class="featured-artists-products__products">
                <div>
                  <h4 class="featured-artists-products__subtitle">{{ section.settings.subtitle }}</h4>
                  <div class="featured-artists-products__grid">
                    {% for product in artist.products_used.value %}
                      <div class="featured-artists-products__card">
                        {% render 'product-card-featured-artists', product: product %}
                      </div>
                    {% endfor %}
                  </div>
                </div>
              </div>
            {% endif %}

            <section>
              <div class="spotify-embed__main featured-artist-spotify-container">
                <div class="spotify-embed__iframe-container">
                  {{ artist.spotify_embed_url }}
                </div>
                <div class="spotify-embed__button-container {% if section.settings.center_buttons %}spotify-embed__button-container-center{% endif %}">
                  {% assign tidal_url = artist.tidal %}
                  {% if tidal_url != blank %}
                    <a
                      href="{{ tidal_url }}"
                      target="_blank"
                      rel="noopener noreferrer"
                      class="spotify-embed__button button button--primary"
                      aria-label="Listen on Tidal"
                    >
                      <span class="button-text">Listen on</span>
                      <img
                        class="spotify-embed__button-logo"
                        height="32"
                        width="32"
                        src="{{ 'tidal.svg' | asset_url }}"
                        alt="Tidal"
                        loading="lazy"
                      >
                    </a>
                  {% endif %}
                  {% assign spotify_url = artist.spotify %}
                  {% if spotify_url != blank %}
                    <a
                      href="{{ spotify_url }}"
                      target="_blank"
                      rel="noopener noreferrer"
                      class="spotify-embed__button button button--primary"
                      aria-label="Listen on Spotify"
                    >
                      <span class="button-text">Listen on</span>
                      <img
                        class="spotify-embed__button-logo"
                        height="32"
                        width="32"
                        src="{{ 'spotify.svg' | asset_url }}"
                        alt="Spotify"
                        loading="lazy"
                      >
                    </a>
                  {% endif %}
                  {% assign youtube_url = artist.youtube %}
                  {% if youtube_url != blank %}
                    <a
                      href="{{ youtube_url }}"
                      target="_blank"
                      rel="noopener noreferrer"
                      class="spotify-embed__button button button--primary"
                      aria-label="Listen on YouTube"
                    >
                      <span class="button-text">Listen on</span>
                      <img
                        class="spotify-embed__button-logo"
                        height="32"
                        width="32"
                        src="{{ 'youtube.svg' | asset_url }}"
                        alt="YouTube"
                        loading="lazy"
                      >
                    </a>
                  {% endif %}
                </div>
              </div>
            </section>
          </div>
          {% comment %}
            <div class="featured-artists-products section-{{ section.id }}-padding color-{{ section.settings.color_scheme }} {% if settings.animations_reveal_on_scroll %} scroll-trigger animate--fade-in{% endif %}">
              <div class="page-width">
                <div class="featured-artists-products__header">
                  {% if artist.spotify %}
                    <a
                      href="{{ artist.spotify }}"
                      target="_blank"
                      class="featured-artists-products__spotify"
                    >
                      <img height="100" width="100" src="{{ 'icon-spotify.svg' | asset_url }}" alt="Spotify">
                    </a>
                  {% endif %}
                  {% if artist.apple_music %}
                    <a
                      href="{{ artist.apple_music }}"
                      target="_blank"
                      class="featured-artists-products__apple"
                    >
                      <img height="100" width="100" src="{{ 'icon-apple-music.svg' | asset_url }}" alt="Apple Music">
                    </a>
                  {% endif %}
                  {% if artist.artists_website %}
                    <a
                      href="{{ artist.artists_website }}"
                      target="_blank"
                      class="featured-artists-products__spotify"
                    >
                      Visit Website
                    </a>
                  {% endif %}
                  <div class="featured-artists-products__text">
                    <h2>{{ artist.title }}</h2>
                    <p>
                      {{ artist.genre }}
                    </p>
                    <p>{{ artist.description }}</p>

                    {% for profile in artist.artists_social_media.value %}
                      <p>
                        <a href="{{ profile.url }}" target="_blank" rel="noopener"> Follow on {{ profile.platform }} </a>
                      </p>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>

            {% if artist.products_used %}
              <div class="featured-artists-products__products">
                <div>
                  <h3>Products they love</h3>
                  <div class="featured-artists-products__grid">
                    {% for product in artist.products_used.value %}
                      <div class="featured-artists-products__card">
                        {% render 'product-card-multicolour', product: product %}
                      </div>
                    {% endfor %}
                  </div>
                </div>
              </div>
            {% endif %}
          {% endcomment %}
        </div>
      </div>
    {% endfor %}
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const wrapper = document.querySelector('.dynamic-artists-gallery-wrapper');
    const galleryItems = Array.from(document.querySelectorAll('.gallery-item'));

    galleryItems.forEach((item, index) => {
      item.addEventListener('click', function () {
        let parentEl = item.parentElement;
        const isActive = !item.classList.contains('active');
        let currentActive = parentEl.querySelectorAll('.gallery-item.active');
        item.classList.toggle('active', isActive);
        if (currentActive.length > 0) {
          for (let i = 0; i < currentActive.length; i++) {
            currentActive[i].classList.remove('active');
          }
        }

        // Scroll into view
        if (!isActive) {
          const offset = 80;
          const top = item.getBoundingClientRect().top + window.pageYOffset - offset;
          window.scrollTo({ top, behavior: 'smooth' });
        }
      });
    });
  });
</script>

{% schema %}
{
  "name": "Dynamic Artists Gallery",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "Dynamic Artists Gallery",
      "category": "Custom"
    }
  ]
}
{% endschema %}
